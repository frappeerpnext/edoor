{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2023-10-11 16:48:47.179901",
 "css": "",
 "custom_format": 0,
 "default_print_language": "en",
 "disabled": 0,
 "doc_type": "Business Branch",
 "docstatus": 0,
 "doctype": "Print Format",
 "font_size": 14,
 "format_data": "[{\"fieldname\": \"print_heading_template\", \"fieldtype\": \"Custom HTML\", \"options\": \"<div>\\t\\n   \\n</div>\"}, {\"fieldtype\": \"Section Break\", \"label\": \"Conflict Room\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"{% set data = frappe.db.sql(\\\"\\n                with a as (select \\n                                room_id,\\n                                date \\n                        from `tabTemp Room Occupy` \\n                        where \\n                                ifnull(room_id,'')!='' and \\n                                is_departure=0 and date>='{0}' and \\n                                type='Reservation' and \\n                                reservation_status!='Checked Out' \\n                        group by \\n                                date,\\n                                room_id \\n                        having count(room_id)>1)\\n                ,b as (select distinct \\n                                reservation_stay \\n                        from `tabTemp Room Occupy` \\n                        where \\n                                room_id in(select room_id from a) and \\n                                date in (select date from a))\\n                        select * from `tabReservation Stay` where name in (select reservation_stay from b)\\n\\\".format(doc.name,\\n        frappe.form_dict.get('date')\\n        ),as_dict=1)%}\\n\\n<div style=\\\"font-size:16px;margin-top:7px\\\"><strong>{{_(\\\"Conflict Room Assignment\\\")}}</strong></div>\\n {% if data %}\\n<table class='report-list occupied-001' style=\\\"width:100%;margin-top:7px;\\\">\\n        <tr>\\n            <th class=\\\"text-center\\\">{{_(\\\"No.\\\")}}</th>\\n            <th class=\\\"text-center\\\">{{_(\\\"Res #\\\")}}</th>\\n            <th class=\\\"text-center\\\">{{_(\\\"Stay #\\\")}}</th>\\n            <th class=\\\"text-center\\\">{{_(\\\"Type\\\")}}</th>\\n            <th>{{_(\\\"Res Date\\\")}}</th>\\n            <th>{{_(\\\"Arrival Date\\\")}}</th>\\n            <th>{{_(\\\"Departure Date\\\")}}</th>\\n            <th class=\\\"text-center\\\">{{_(\\\"Room Night\\\")}}</th>\\n            <th class=\\\"text-center\\\">{{_(\\\"Room\\\")}}</th>\\n            <th>{{_(\\\"Guest\\\")}}</th>\\n            <th>{{_(\\\"Source\\\")}}</th>\\n            <th class=\\\"text-end nowrap\\\">{{_(\\\"ADR\\\")}}</th>\\n            <th class=\\\"text-end nowrap\\\">{{_(\\\"Total Room Rate\\\")}}</th>\\n            <th class=\\\"text-end nowrap\\\">{{_(\\\"Status\\\")}}</th>\\n        </tr>\\n        {% for d in data  %}\\n        <tr>\\n            <td class=\\\"text-center\\\">{{loop.index}}</td>\\n            <td class=\\\"text-center\\\"><a class=\\\"p-0 link_line_action1\\\" onclick=\\\"window.parent.postMessage('view_reservation_detail|{{d.reservation}}', '*')\\\">{{d.reservation or ''}}</a></td>\\n            <td class=\\\"text-center\\\"><a class=\\\"p-0 link_line_action1\\\" onclick=\\\"window.parent.postMessage('view_reservation_stay_detail|{{d.name}}', '*')\\\">{{d.name or ''}}</a></td>\\n            <td class=\\\"text-center\\\">{{d.reservation_type or ''}}</td>\\n            <td>{{frappe.format(d.reservation_date or '',{'fieldtype':'Date'})}}</td>\\n            <td> {{frappe.format(d.arrival_date or '',{'fieldtype':'Date'})}}</td>\\n            <td> {{frappe.format(d.departure_date or '',{'fieldtype':'Date'})}}</td>\\n            <td class=\\\"text-center\\\">{{d.room_nights or 0}}</td>\\n            <td class=\\\"text-center\\\">{{d.room_type_alias or ''}}/{{d.rooms or ''}}</td>\\n            <td><a class=\\\"p-0 link_line_action1\\\" onclick=\\\"window.parent.postMessage('view_guest_detail|{{d.guest}}', '*')\\\">{{d.guest_name or ''}}</a></td>\\n            <td>{{d.business_source or ''}}</td>\\n            <td class=\\\"text-end nowrap\\\">{{frappe.format(d.adr or '',{'fieldtype':'Currency'})}}</td>\\n            <td class=\\\"text-end nowrap\\\">{{frappe.format(d.total_room_rate or '',{'fieldtype':'Currency'})}}</td>\\n            <td class=\\\"text-center\\\"><span style=\\\"background: {{d.status_color}}\\\" class=\\\"rounded-pill py-1 px-2 text-white\\\">{{d.reservation_status}}</span></td>\\n        </tr>\\n        {% endfor %}\\n</table>\\n{% else %}\\n    <div class=\\\"mt-4 print-heading text-center p-2\\\">\\n    <div class=\\\"isemtyIcon\\\"></div> \\n    <small class=\\\"text-emty\\\">No Data </small>\\n    </div>\\n    {% endif %}\"}, {\"fieldtype\": \"Section Break\", \"label\": \"Over Booking Reservation\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"{% set data = frappe.db.sql(\\\"\\r\\n                with a as (select \\r\\n                                room_type,\\r\\n                                room_type_id,\\r\\n                                count(name) as total_room \\r\\n                from `tabRoom` \\r\\n                group by room_type_id)\\r\\n                ,b as (select \\r\\n                                sum(type='Reservation') as total_booking, \\r\\n                                sum(type='Block') as total_block, \\r\\n                                room_type_id,date \\r\\n                from `tabTemp Room Occupy` \\r\\n                group by \\r\\n                                date,\\r\\n                                room_type_id)\\r\\n                select *, \\r\\n                                (b.total_booking-a.total_room) as total_over_booking,\\r\\n                                (a.total_room-b.total_block) as total_available \\r\\n                                \\r\\n                from a \\r\\n                inner join b on a.room_type_id = b.room_type_id \\r\\n                where \\r\\n                                b.total_booking > (a.total_room-b.total_block) \\r\\n                order by \\r\\n                                b.date,\\r\\n                                a.room_type\\r\\n\\r\\n\\\".format(doc.name\\r\\n        ),as_dict=1)%}\\r\\n        \\r\\n<div style = \\\"font-size:16px;margin-top:15px\\\"><strong>{{_(\\\"Over Booking Reservation\\\")}}</strong></div>\\r\\n\\r\\n{% if data %}\\r\\n<table class='report-list occupied-001' style=\\\"width:100%;margin-top:7px;\\\">\\r\\n    <tr>\\r\\n        <th class=\\\"text-center\\\">{{_(\\\"No.\\\")}}</th>\\r\\n        <th>{{_(\\\"Room Type\\\")}}</th>\\r\\n        <th>{{_(\\\"Total Room\\\")}}</th>\\r\\n        <th>{{_(\\\"Total Block\\\")}}</th>\\r\\n        <th>{{_(\\\"Total Available\\\")}}</th>\\r\\n        <th>{{_(\\\"Total Booking\\\")}}</th>\\r\\n        <th>{{_(\\\"Total Over Booking\\\")}}</th>\\r\\n    </tr>\\r\\n    {% for date in data | map(attribute='date') | unique | list |sort %}\\r\\n    <tr>\\r\\n        <td><strong><a class=\\\"p-0 link_line_action1\\\" onclick=\\\"window.parent.postMessage({action:'view_property_data_sumary_by_date', date:'{{date}}'}, '*')\\\">{{frappe.format(date,{'fieldtype':'Date'})}}</a></strong></td>\\r\\n        <td></td>\\r\\n        <td></td>\\r\\n        <td></td>\\r\\n        <td></td><td></td>\\r\\n        <td></td>\\r\\n    </tr>\\r\\n        {% for d in data | selectattr('date', 'equalto', date) %}\\r\\n            <tr>\\r\\n                <td class=\\\"text-center\\\">{{loop.index}}</td>\\r\\n                <td><a class=\\\"p-0 link_line_action1\\\" onclick=\\\"window.parent.postMessage({action:'view_property_data_sumary_by_date', date:'{{d.date}}',room_type_id:'{{d.room_type_id}}',room_type:'{{d.room_type}}'}, '*')\\\">{{d.room_type}}</a></td>\\r\\n                <td>{{d.total_room }}</td>\\r\\n                <td>{{d.total_block | round | int}}</td>\\r\\n                <td>{{d.total_available | round | int}}</td>\\r\\n                <td>{{d.total_booking | round | int}}</td>\\r\\n                <td>{{d.total_over_booking | round | int}}</td>\\r\\n            </tr>\\r\\n        {% endfor %}\\r\\n    {% endfor %}\\r\\n</table>\\r\\n{% else %}\\r\\n    <div class=\\\"mt-4 print-heading text-center p-2\\\">\\r\\n    <div class=\\\"isemtyIcon\\\"></div> \\r\\n    <small class=\\\"text-emty\\\">No Data </small>\\r\\n    </div>\\r\\n    {% endif %}\\r\\n    \"}]",
 "idx": 0,
 "line_breaks": 0,
 "margin_bottom": 15.0,
 "margin_left": 15.0,
 "margin_right": 15.0,
 "margin_top": 15.0,
 "modified": "2023-10-25 22:31:40.110472",
 "modified_by": "Administrator",
 "module": "eDoor",
 "name": "eDoor Conflict Room Assignment and Over Booking Reservation",
 "owner": "Administrator",
 "page_number": "Hide",
 "print_format_builder": 0,
 "print_format_builder_beta": 0,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}